# Классификация Назначения Платежей

---

## Структура репозитория

- `input_file.tsv`  
  Входной файл для получения предсказания. ***Вам нужно заменить содержимое этого файла своими данными, сохранив его название.***

- `models/automl_model.pkl`  
  Сохранённая модель, используемая для предсказаний.

- `notebooks/`  
  Содержит Jupyter Notebooks с анализом данных (EDA), разметкой, обучением и кросс-валидацией.

- `predict.py`  
  Скрипт для запуска предсказаний модели.

- `prediction_api.py`  
  API для предоставления предсказаний на основе модели.

## Запуск
Для запуска проекта необходим работающий Docker:
1. В корневой каталог проекта необходимо поместить тестовый файл: input_file.tsv **сохранив его название**.
2. Для сборки образа и его запуска используем:
```bash
docker build -t biv-hack .
docker run -v ${PWD}:/app biv-hack
```
3. Во время работы модель логирует события в терминал.
4. В итоге вы получаете файл в корневом каталоге.

(*) Также важное замечание! Если меняется тестовый файл, то образ необходимо заново собирать. Но время сборки будет в разы меньше за счет использования кэша.

## Время сборки и запуска

1. **Первая сборка Docker-образа**:  
   - Занимает около **10 минут**.

2. **Повторные пересборки**:  
   - Благодаря использованию кэша, время сборки сокращается до **2 минут**.

3. **Время инференса решения**:  
   - Обработка 25 000 записей моделью занимает примерно **5 минут 40 секунд**.

## Обзор Решения

Наш подход включает следующие ключевые компоненты:

**Оценка эмбеддингов**
- Тестирование моделей из MTEB, выбор лучших по точности и скорости.

**Предобработка текста**
- Нормализация текста: приведение к нижнему регистру, замена дат и номеров на шаблоны.
- Вычисление дополнительных признаков: читаемость текста, разница в датах.

**Обучение модели CatBoost**
- Классификация с использованием эмбеддингов, дат, сумм платежей и сгенерированных признаков.

**Разметка данных с GPT-4o**
- Добавлено 25 000 записей. Использованы только записи с совпадающими предсказаниями CatBoost и GPT-4o для повышения качества.

**Блендинг и метамодель**
- Блендинг моделей (логистическая регрессия, CatBoost) для повышения точности и устойчивости.

**Оптимизация и валидация**
- Кросс-валидация, выбор модели с наилучшей производительностью.

**Dockerизация**
- Упаковка пайплайна в Docker для удобства развёртывания и воспроизводимости.
---

## Детали Реализации

### Оценка Эмбеддингов
- **Бенчмаркинг моделей**: Проведён анализ моделей из MTEB для выбора оптимальной по скорости и качеству.
- **Критерии выбора**: Баланс между интерпретируемостью и точностью.

### Обучение Моделей
- **Логистическая регрессия и блендинг**: Использование смешивания моделей разной природы для повышения точности.
- **CatBoost**: Дополнительная модель для устойчивости на несбалансированных данных.

### Разметка Дополнительных Данных
- **GPT-4o Mini API**: Разметка 25 000 записей.
- **Фильтрация**: Использование только тех записей, где предсказания CatBoost и GPT-4o Mini совпадали.

### Оптимизация Модели
- **Эксперименты**:
  - Дообучение линейных слоёв.
  - TF-IDF и логистическая регрессия.
  - блендинг линейных моделей и бустингов.
- **Кросс-валидация**: Проверка обобщающей способности.
- **Выбор модели**: Лучший результат на валидационном наборе.

### Предобработка Текста
- **Нормализация**: Приведение текста к нижнему регистру, удаление пунктуации.
- **Токенизация**: Разбиение текста на токены.
- **Удаление стоп-слов**: Исключение нерелевантных слов.

### Dockerизация
- **Контейнеризация**: Упаковка пайплайна в Docker.
- **Воспроизводимость**: Гарантированное единообразие окружения.

---

## Результаты

- **Точность**: Высокая точность на валидационном наборе.
- **Эффективность**: Низкая задержка, подходящая для реального времени.
- **Масштабируемость**: Возможность горизонтального масштабирования.

---

## Реализованный Дополнительный Функционал

- **Реализация API**: RESTful API для взаимодействия с внешними системами.
- **Обработка мульти-язычных данных**: Поддержка нескольких языков.

---

## Идеи Развития

- **Автоматизация переобучения модели**: Пайплайн Airflow для актуализации модели.
- **Пайплайн разметки данных**: Удобный процесс для ручной разметки.
- **Использование более мощных моделей**: Интеграция GPU для трансформеров.
- **Разработка веб-интерфейса**: Визуализация результатов и аналитика.

---