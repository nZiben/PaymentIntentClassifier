# Классификация Назначения Платежей

---

## Структура Решения

```
├── Dockerfile
├── README.md
├── data
│   └── stratified_dataset_union_gpt_catboost.csv
├── input_file.tsv
├── models
│   ├── .gitkeep
│   └── automl_model.pkl
├── notebooks
│   ├── eda
│   │   └── EDA.ipynb
│   ├── labeling
│   │   └── 4o_labeling.ipynb
│   └── training
│       ├── embedding_to_catboost_crossval.ipynb
│       └── train_model_part_of_the_data.ipynb
├── predict.py
├── prediction_api.py
├── requirements.txt
└── src
    └── .gitkeep
```

## Запуск
Для запуска проекта необходим работающий Docker:
1. В корневой каталог проекта необходимо поместить тестовый файл: `input_file.tsv`
2. Для сборки образа и его запуска используем:
```bash
docker build -t biv-hack .
docker run -v ${PWD}:/app biv-hack
```
3. Во время работы модель логирует события в терминал
4. В итоге вы получаете файл в кореновм каталоге

(*) Также важное замечание! Если меняется тестовый файл, то образ необходимо ЗАНОВО собирать. Но время 
сборки будет в разы меньше за счет сборки кэша.

## Обзор Решения

Наш подход включает следующие ключевые компоненты:

- **Оценка эмбеддингов**: Тестирование и выбор лучших моделей эмбеддингов из бенчмарка MTEB.
- **Обучение модели CatBoost**: Классификация с использованием эмбеддингов и суммы платежей.
- **Разметка данных с помощью GPT-4o Mini API**: Расширение обучающей выборки на 25 000 записей.
- **Оптимизация и валидация**: Выбор лучшей модели после кросс-валидации.
- **Предобработка текста**: Нормализация и очистка назначений платежей.
- **Dockerизация**: Упаковка пайплайна в Docker для удобства развёртывания.

---

## Детали Реализации

### Оценка Эмбеддингов
- **Тестирование моделей**: Проверено более семи эмбеддингов (трансформеры, sentence encoders).
- **Критерии выбора**: Компромисс между точностью и скоростью.

### Обучение Модели
- **Обучение CatBoost**: Использование первых 500 размеченных записей.
- **Несбалансированные данные**: Применение взвешивания классов.

### Разметка Дополнительных Данных
- **GPT-4o Mini API**: Разметка 25 000 записей.
- **Фильтрация**: Использование только тех записей, где предсказания модели и API совпадали.

### Оптимизация Модели
- **Эксперименты**:
  - Дообучение линейных слоёв.
  - TF-IDF и логистическая регрессия.
  - Стекинг линейных моделей и бустингов.
- **Кросс-валидация**: Проверка обобщающей способности.
- **Выбор модели**: Лучший результат на валидационном наборе.

### Предобработка Текста
- **Нормализация**: Приведение текста к нижнему регистру, удаление пунктуации.
- **Токенизация**: Разбиение текста на токены.
- **Удаление стоп-слов**: Исключение нерелевантных слов.

### Dockerизация
- **Контейнеризация**: Упаковка пайплайна в Docker.
- **Воспроизводимость**: Гарантированное единообразие окружения.

---

## Результаты

- **Точность**: Высокая точность на валидационном наборе.
- **Эффективность**: Низкая задержка, подходящая для реального времени.
- **Масштабируемость**: Возможность горизонтального масштабирования.

---

## Реализованный Дополнительный Функционал

- **Реализация API**: RESTful API для взаимодействия с внешними системами.
- **Обработка мульти-язычных данных**: Поддержка нескольких языков.

---

## Идеи Развития

- **Автоматизация переобучения модели**: Пайплайн Airflow для актуализации модели.
- **Пайплайн разметки данных**: Удобный процесс для ручной разметки.
- **Использование более мощных моделей**: Интеграция GPU для трансформеров.
- **Разработка веб-интерфейса**: Визуализация результатов и аналитика.

--- 

## Заключение

Данное решение демонстрирует успешное применение методов NLP и машинного обучения для автоматизации классификации назначений платежей. Использование Docker, гибких моделей и дополнительных функций делает его мощным инструментом для интеграции в банковские системы.

